<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych-7.0/dist/jspsych.js"></script>
    <script src="jspsych-7.0/dist/plugin-preload.js"></script>
    <script src="jspsych-7.0/dist/plugin-fullscreen.js"></script>
    <script src="jspsych-7.0/dist/plugin-survey-text.js"></script>
    <script src="jspsych-7.0/dist/plugin-html-button-response.js"></script>
    <script src="jspsych-7.0/dist/plugin-html-keyboard-response.js"></script>
    <script src="jspsych-7.0/dist/plugin-video-button-response.js"></script>
    <link href="jspsych-7.0/dist/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script>
  const jsPsych = initJsPsych();

  var preload = {
    type: jsPsychPreload,
    auto_preload: true
  }

  var participant_info = {
    type: jsPsychSurveyText,
    questions: [
      {prompt: "Participant name", name: "participant_name"},
      {prompt: "Participant ID", name: "participant_ID"}
    ],
    data: {task_part: 'id-question'}
  }

  var fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: true,
    message: "<p>Let's play the shape game with Monster!</p>",
    data: {task_part: 'fullscreen'}
  };

  var demo = {
      timeline: [
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: "<p>bla bla bla</p>",
          trial_duration: 1000
        },
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: "<p>There are some shapes that Monster likes to eat.</p>" +
                    "<p>When you feed it a shape it likes, Monster gives you a star.</p>",
          trial_duration: 1000
        },
        {
          type: jsPsychHtmlButtonResponse,
          stimulus: '<img src="img/mimg330-1.png"></img>',
          choices: ['img/f1a.png','img/f1b.png'],
          button_html: '<img src="%choice%" />',
        },
        {
          type: jsPsychVideoButtonResponse,
          stimulus: [
            'videos/m1- correct.mp4'
          ],
          choices: ['img/f1a.png','img/f1b.png'],
          button_html: '<img src="%choice%" />',
          response_allowed_while_playing: false,
          trial_ends_after_video: true
        },
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: "<p>There are other shapes that Monster doesn't like to eat.</p>" +
                    "<p>When you feed it a shape it doesn't like, Monster won't give you a star.</p>",
          trial_duration: 1000
        },
        {
          type: jsPsychHtmlButtonResponse,
          stimulus: '<img src="img/mimg330-1.png"></img>',
          choices: ['img/f1a.png','img/f1b.png'],
          button_html: '<img src="%choice%" />',
        },
        {
          type: jsPsychVideoButtonResponse,
          stimulus: [
            'videos/m1-wrong.mp4'
          ],
          choices: ['img/f1a.png','img/f1b.png'],
          button_html: '<img src="%choice%" />',
          response_allowed_while_playing: false,
          trial_ends_after_video: true
        },
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: "<p>Your goal is to feed Monster as many shapes it likes to eat as you can and get as many stars as you can.</p>",
          trial_duration: 1000
        },
      ],
      data: {task_part: 'demo'}
    }

    var night = {
      type: jsPsychVideoButtonResponse,
        stimulus: [
          'videos/monster-bedtime.mp4'
        ],
        choices: [],
        response_allowed_while_playing: false,
        trial_ends_after_video: true,
        data: {task_part: 'night'}
    }

    var day1 = {
        timeline: [
            {
                type: jsPsychHtmlButtonResponse,
                stimulus: '<img src="img/mimg330-1.png"></img>',
                choices: [
                            jsPsych.timelineVariable('choiceA'),
                            jsPsych.timelineVariable('choiceB'),
                            jsPsych.timelineVariable('choiceC'),
                            jsPsych.timelineVariable('choiceD')
                          ],
                button_html: '<img src="%choice%" />',
                save_trial_parameters: {
                  choices: true
                },
                on_finish: function(data){
                  // Score the keyboard response as correct or incorrect.
                  data.correct_response = jsPsych.timelineVariable("correct_response");
                  data.correct = data.correct_response.includes(data.response);
                  //data.test1 = data.set;
                }
            },
            {
              type: jsPsychVideoButtonResponse,
              stimulus: function(){
                var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
                if(last_trial_correct){
                  return [
                    'videos/m1- correct.mp4'
                  ]; // the parameter value has to be returned from the function
                } else {
                  return [
                    'videos/m1-wrong.mp4'
                  ]; // the parameter value has to be returned from the function
                }
              },
              choices: function(){
                return jsPsych.data.get().last(1).values()[0].choices
                },
              button_html: '<img src="%choice%" />',
              response_allowed_while_playing: false,
              trial_ends_after_video: true
            }
          ],
        timeline_variables: [
            {choiceA: 'img/shapes/14g.png', choiceB: 'img/shapes/33o.png', choiceC: 'img/shapes/56r.png', choiceD: 'img/shapes/75b.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/43r.png', choiceB: 'img/shapes/15g.png', choiceC: 'img/shapes/66b.png', choiceD: 'img/shapes/24o.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/25r.png', choiceB: 'img/shapes/73o.png', choiceC: 'img/shapes/86g.png', choiceD: 'img/shapes/44b.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/43o.png', choiceB: 'img/shapes/65r.png', choiceC: 'img/shapes/54g.png', choiceD: 'img/shapes/36b.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/63g.png', choiceB: 'img/shapes/76b.png', choiceC: 'img/shapes/15o.png', choiceD: 'img/shapes/34r.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/34o.png', choiceB: 'img/shapes/45g.png', choiceC: 'img/shapes/26b.png', choiceD: 'img/shapes/83r.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/13b.png', choiceB: 'img/shapes/74r.png', choiceC: 'img/shapes/46o.png', choiceD: 'img/shapes/85g.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/35b.png', choiceB: 'img/shapes/64o.png', choiceC: 'img/shapes/23g.png', choiceD: 'img/shapes/16r.png', correct_response: []}, //no response is correct
          ],
        repetitions: 1,
        randomize_order: true,
        data: {task_part: 'day-1'}
      }

    var day2 = {
        timeline: [
            {
                type: jsPsychHtmlButtonResponse,
                stimulus: '<img src="img/mimg330-1.png"></img>',
                choices: [
                            jsPsych.timelineVariable('choiceA'),
                            jsPsych.timelineVariable('choiceB'),
                            jsPsych.timelineVariable('choiceC'),
                            jsPsych.timelineVariable('choiceD')
                          ],
                button_html: '<img src="%choice%" />',
                save_trial_parameters: {
                  choices: true
                },
                on_finish: function(data){
                  // Score the keyboard response as correct or incorrect.
                  data.correct_response = jsPsych.timelineVariable("correct_response");
                  data.correct = data.correct_response.includes(data.response);
                  //data.test1 = data.set;
                }
            },
            {
              type: jsPsychVideoButtonResponse,
              stimulus: function(){
                var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
                if(last_trial_correct){
                  return [
                    'videos/m1- correct.mp4'
                  ]; // the parameter value has to be returned from the function
                } else {
                  return [
                    'videos/m1-wrong.mp4'
                  ]; // the parameter value has to be returned from the function
                }
              },
              choices: function(){
                return jsPsych.data.get().last(1).values()[0].choices
                },
              button_html: '<img src="%choice%" />',
              response_allowed_while_playing: false,
              trial_ends_after_video: true
            }
          ],
        timeline_variables: [
            {choiceA: 'img/shapes/25b.png', choiceB: 'img/shapes/14o.png', choiceC: 'img/shapes/36g.png', choiceD: 'img/shapes/13r.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/55r.png', choiceB: 'img/shapes/26g.png', choiceC: 'img/shapes/43b.png', choiceD: 'img/shapes/74o.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/53g.png', choiceB: 'img/shapes/46r.png', choiceC: 'img/shapes/85o.png', choiceD: 'img/shapes/74b.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/44g.png', choiceB: 'img/shapes/33r.png', choiceC: 'img/shapes/65b.png', choiceD: 'img/shapes/16o.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/15r.png', choiceB: 'img/shapes/34b.png', choiceC: 'img/shapes/66g.png', choiceD: 'img/shapes/23o.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/75g.png', choiceB: 'img/shapes/63o.png', choiceC: 'img/shapes/86r.png', choiceD: 'img/shapes/54b.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/35g.png', choiceB: 'img/shapes/16b.png', choiceC: 'img/shapes/73r.png', choiceD: 'img/shapes/54o.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/64r.png', choiceB: 'img/shapes/13g.png', choiceC: 'img/shapes/56b.png', choiceD: 'img/shapes/45o.png', correct_response: []}, //no response is correct
          ],
        repetitions: 1,
        randomize_order: true,
        data: {task_part: 'day-2'}
      }

    var day3 = {
        timeline: [
            {
                type: jsPsychHtmlButtonResponse,
                stimulus: '<img src="img/mimg330-1.png"></img>',
                choices: [
                            jsPsych.timelineVariable('choiceA'),
                            jsPsych.timelineVariable('choiceB'),
                            jsPsych.timelineVariable('choiceC'),
                            jsPsych.timelineVariable('choiceD')
                          ],
                button_html: '<img src="%choice%" />',
                save_trial_parameters: {
                  choices: true
                },
                on_finish: function(data){
                  // Score the keyboard response as correct or incorrect.
                  data.correct_response = jsPsych.timelineVariable("correct_response");
                  data.correct = data.correct_response.includes(data.response);
                  //data.test1 = data.set;
                }
            },
            {
              type: jsPsychVideoButtonResponse,
              stimulus: function(){
                var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
                if(last_trial_correct){
                  return [
                    'videos/m1- correct.mp4'
                  ]; // the parameter value has to be returned from the function
                } else {
                  return [
                    'videos/m1-wrong.mp4'
                  ]; // the parameter value has to be returned from the function
                }
              },
              choices: function(){
                return jsPsych.data.get().last(1).values()[0].choices
                },
              button_html: '<img src="%choice%" />',
              response_allowed_while_playing: false,
              trial_ends_after_video: true
            }
          ],
        timeline_variables: [
            {choiceA: 'img/shapes/33b.png', choiceB: 'img/shapes/25g.png', choiceC: 'img/shapes/14r.png', choiceD: 'img/shapes/66o.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/75o.png', choiceB: 'img/shapes/23r.png', choiceC: 'img/shapes/34g.png', choiceD: 'img/shapes/86b.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/85r.png', choiceB: 'img/shapes/46b.png', choiceC: 'img/shapes/53o.png', choiceD: 'img/shapes/24g.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/15b.png', choiceB: 'img/shapes/83g.png', choiceC: 'img/shapes/44r.png', choiceD: 'img/shapes/26o.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/55b.png', choiceB: 'img/shapes/74g.png', choiceC: 'img/shapes/63r.png', choiceD: 'img/shapes/36o.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/35r.png', choiceB: 'img/shapes/43g.png', choiceC: 'img/shapes/76o.png', choiceD: 'img/shapes/64b.png', correct_response: [0,1,2,3]}, //all responses are correct
            {choiceA: 'img/shapes/45r.png', choiceB: 'img/shapes/13o.png', choiceC: 'img/shapes/24b.png', choiceD: 'img/shapes/56g.png', correct_response: []}, //no response is correct
            {choiceA: 'img/shapes/16g.png', choiceB: 'img/shapes/54r.png', choiceC: 'img/shapes/73b.png', choiceD: 'img/shapes/35o.png', correct_response: []}, //no response is correct
          ],
        repetitions: 1,
        randomize_order: true,
        data: {task_part: 'day-3'}
      }

  var feedback = {
    timeline: [
      {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: "<p>Let's see how you did in the game.</p>",
        trial_duration: 1000
      },
      {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '<img src="img/star_small_0gold3.png"></img>',
        trial_duration: 1000
      },
      {
        type: jsPsychVideoButtonResponse,
          stimulus: [
            'videos/monster-bedtime.mp4'
          ],
          choices: [],
          response_allowed_while_playing: false,
          trial_ends_after_video: true
      }
    ],
    data: {task_part: 'summary-feedback'}
  }

  var survey = {
      timeline: [
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: "<p>Did you feel like you got better at the game?</p>"
        }
      ],
      data: {task_part: 'exit-survey'}
  }

  //end message//
  var ending = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "<p>Thank you for participating in this game!</p>",
    on_start: function(data){
      var id = jsPsych.data.get().filter({task_part: 'id-question'}).values()[0].response['participant_ID'];
      var file_name = 'LT_' + id + '.csv';
      jsPsych.data.get().localSave('csv',file_name); // Saves a file on the computer running the experiment. First localSave argument is the format, second is the filename.
    }
  };

  jsPsych.run([
    preload,
    participant_info,
    fullscreen,
    demo,
    day1,
    night,
    day2,
    night,
    day3,
    night,
    feedback,
    survey,
    ending
  ]);
  </script>
</html>
